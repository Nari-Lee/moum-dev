<!-- boardView.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 상세보기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/board.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/collection.css}" type="text/css">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <meta name="_csrf" th:content="${_csrf.token}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div th:replace="~{header}"></div>
<main>
    <div class="page-container">
        <div class="post-grid">
            <!-- 메인 이미지 섹션 -->


            <!-- 게시글 헤더 -->
            <div class="post-header">
                <h1 class="post-title">
                    <span th:text="${board.title}">게시글 제목</span>
                    <!-- 카테고리 표시 -->
                    <small class="text-muted" th:text="'[' + ${board.maincategory.name} + ']'">[카테고리]</small>
                </h1>
                <div class="post-meta">
                    <span th:text="${board.user.nickname}">작성자</span>
                    <span>조회수: <span th:text="${board.viewCount}">0</span></span>
                    <span>추천수: <span id="likeCount" th:text="${board.likeCount}">0</span></span>
                    <div class="post-meta-date">
                        <span th:text="${#dates.format(board.postDate, 'yyyy-MM-dd HH:mm')}">작성일</span>
                    </div>
                </div>
            </div>

            <!-- 거래 정보 (있는 경우) -->
            <div th:if="${board.boardType == 'trade'}" class="trade-info">
                <div class="trade-box">
                    <div><strong>가격:</strong> <span th:text="${board.price}">0</span>원</div>
                    <div><strong>거래 상태:</strong> <span th:text="${board.sellOrSoldStatus ? '거래완료' : '거래중'}">미설정</span></div>
                    <div><strong>거래 방식:</strong> <span th:text="${board.tradeType == 'sell' ? '판매' : '구매'}">거래 방식 없음</span></div>
                </div>
            </div>

            <!-- 게시글 내용 -->
            <div class="post-content" th:utext="${board.content}">
                게시글 내용
            </div>

            <!-- 추천/신고 버튼 -->
            <div class="action-buttons">
                <!-- 거래완료 버튼 -->
                <button class="trade-complete"
                        th:if="${(authenticatedUser.no == board.userNo or authenticatedUser.admin) and board.sellOrSoldStatus == false and board.boardType == 'trade'}"
                        th:attr="disabled=${board.sellOrSoldStatus}"
                        th:onclick="${board.sellOrSoldStatus} ? null : 'tradeComplete(' + ${board.no} + ', ' + ${board.maincategory.no} + ')'">
                    거래완료
                </button>



                <!-- 수정 버튼 -->
                <button class="edit-button" data-th-onclick="'editPost(' + ${board.no}+')'"
                        th:if="${(board.sellOrSoldStatus == false) and (authenticatedUser.no == board.userNo or authenticatedUser.admin)}">
                    수정하기
                </button>

                <!-- 삭제 버튼 -->
                <form method="post" name="postDeleteForm" th:action="@{/board/delete}">
                    <input name="no" th:value="${board.no}" type="hidden">
                    <input name="_method" type="hidden" value="DELETE">
                    <button class="delete-button" type="button" onclick="deletePostWithDelAchieve()"
                            th:if="${authenticatedUser.no == board.userNo or authenticatedUser.admin}">
                        삭제하기
                    </button>
                </form>

                <button th:if="${authenticatedUser.no != board.userNo && board.boardType == 'trade'}"
                        class="open-chat-btn btn btn-outline-dark" onclick="openChatroomModal(); openChat(0);">채팅하기</button>


                <button class="recommend_button btn btn-outline-dark"
                        th:onclick="'toggleLike(' + ${board.no} + ', ' + ${authenticatedUser.no} + '); changeText(this);'"
                        type="button">🤍</button>

                <button class="report_button btn btn-outline-white"
                        th:if="${board.userNo != authenticatedUser.no and authenticatedUser.admin == false}"
                        onclick="openReport('board');" type="button">🚨</button>

                <button class="btn btn-danger" th:if="${authenticatedUser.admin == true}"
                        data-th-onclick="|openRestrict('board', '${board.no}')|" type="button">경고/제재</button>
            </div>

            <!-- 댓글 섹션 -->
            <div class="comments-section" id="comments-section">
                <ul class="comment-list">
                    <li th:each="comment : ${comments}" th:id="'comment-' + ${comment.no}">
                        <div class="comment-box">
                            <div class="comment-box-deleteBtn">
                                <button class="comment-delete-btn"
                                        th:if="${comment.userNo == authenticatedUser.no}"
                                        th:onclick="'deleteComment(' + ${comment.no} + ');'">삭제</button>
                            </div>
                            <div class="comment-header">
                                <span class="comment-author" th:text="'작성자 :' + ${comment.userNo}">작성자</span>
                                <span class="comment-date" th:text="${#dates.format(comment.date, 'yyyy-MM-dd')}">작성일자</span>
                            </div>
                            <div class="comment-content" th:text="${comment.content}">내용</div>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- 댓글 입력 폼 -->
                <div class="comment-form">
                    <textarea id="commentContent" maxlength="300" oninput="countingLength(this)" rows="3" placeholder="댓글을 입력하세요"></textarea>
                    <p id="counter">0/300자</p>
                    <button class="btn btn-dark" data-th-onclick="'addComment(' + ${board.no} + ')'" type="button">댓글 작성</button>
                </div>
            </div>
        </div>
    </div>
</main>




<!--  수집품 상세 화면  -->
<div class="layer collection-view-layer"></div>

<script src="/js/board.js"></script>
<script src="/js/collection.js"></script>
<footer th:replace="~{footer :: footer}"></footer>
</body>
</html>
