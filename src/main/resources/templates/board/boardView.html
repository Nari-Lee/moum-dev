<!-- boardView.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 상세보기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/board.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/collection.css}" type="text/css">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <meta name="_csrf" th:content="${_csrf.token}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div th:replace="~{header}"></div>
<main>
    <div class="page-container">
        <div class="post-grid">
            <!-- 메인 이미지 섹션 -->
            <div class="main-image-section">
                <img th:if="${board.attachedFiles != null and #lists.size(board.attachedFiles) > 0}"
                     th:src="@{'https://kr.object.ncloudstorage.com/bitcamp-moum/board/' + ${board.attachedFiles[0].filename}}"
                     alt="게시글 이미지">
                <img th:if="${board.attachedFiles == null or #lists.size(board.attachedFiles) == 0}"
                     th:src="@{/images/default-image.png}"
                     alt="기본 이미지">
            </div>

            <!-- 게시글 헤더 -->
            <div class="post-header">
                <h1 class="post-title" th:text="${board.title}">게시글 제목</h1>
                <div class="post-meta">
                    <span th:text="${board.userNo}">작성자</span>
                    <span th:text="${#dates.format(board.postDate, 'yyyy-MM-dd HH:mm')}">작성일</span>
                    <span>조회수: <span th:text="${board.viewCount}">0</span></span>
                    <span>추천수: <span id="likeCount" th:text="${board.likeCount}">0</span></span>
                </div>
            </div>

            <!-- 거래 정보 (있는 경우) -->
            <div th:if="${board.boardType == 'trade'}" class="trade-info">
                <div class="trade-box">
                    <div><strong>가격:</strong> <span th:text="${board.price}">0</span>원</div>
                    <div><strong>거래 상태:</strong> <span th:text="${board.sellOrSoldStatus ? '거래완료' : '거래중'}">미설정</span></div>
                    <div><strong>거래 방식:</strong> <span th:text="${board.tradeType == 'sell' ? '판매' : '구매'}">거래 방식 없음</span></div>
                </div>
            </div>

            <!-- 게시글 내용 -->
            <div class="post-content" th:utext="${board.content}">
                게시글 내용
            </div>

            <!-- 추천/신고 버튼 -->
            <div class="action-buttons">
                <button class="btn btn-warning" th:onclick="'toggleLike(' + ${board.no} + ');'" type="button">추천하기</button>
                <button class="btn btn-warning" th:if="${board.userNo != authenticatedUser.no}"
                        onclick="openReport('board');" type="button">신고하기</button>
            </div>

            <!-- 댓글 섹션 -->
            <div class="comments-section">
                <h3>댓글</h3>
                <ul id="commentList">
                    <li th:each="comment : ${comments}" th:id="'comment-' + ${comment.no}">
                        <p><strong th:text="${comment.userNo}">작성자</strong>: <span th:text="${comment.content}">내용</span></p>
                        <p>작성일: <span th:text="${#dates.format(comment.date, 'yyyy-MM-dd HH:mm')}">2024-10-22</span></p>
                        <button class="btn btn-danger" th:if="${comment.userNo == authenticatedUser.no}"
                                th:onclick="'deleteComment(' + ${comment.no} + ');'">삭제</button>
                        <button class="btn btn-danger" th:if="${comment.userNo != authenticatedUser.no}"
                                th:onclick="'openReport(`comment`, ' + ${comment.no} + ');'">신고</button>
                    </li>
                </ul>

                <!-- 댓글 입력 폼 -->
                <div class="comment-form">
                    <textarea id="commentContent" maxlength="300" oninput="countingLength(this)" rows="3"></textarea>
                    <p id="counter">0/300자</p>
                    <button class="btn btn-primary" onclick="addComment()" type="button">댓글 작성</button>
                </div>
            </div>
        </div>
    </div>
</main>

<script th:inline="javascript">
    let boardId = /*[[${board.no}]]*/[];
    let comments = /*[[${comments}]]*/[];
    const isTrade = /*[[${board.boardType == "trade" ? true : false}]]*/[];

    <!--  수집품 조회화면 사진 인덱스  -->
    let collectionSlideIndex = 0;

    comments.forEach(renderComment);


</script>


<!--  수집품 상세 화면  -->
<div class="layer collection-view-layer"></div>

<script src="/js/board.js"></script>
<script src="/js/collection.js"></script>
<footer th:replace="~{footer :: footer}"></footer>
</body>
</html>
