<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="moum.project.dao.ChatDao">

  <resultMap id="ChatMap" type="moum.project.vo.Chat">
    <id column="chat_id" property="no"/>
    <result column="chatroom_id" property="chatroomNo"/>
    <result column="user_id" property="userNo"/>
    <result column="message" property="message"/>
    <result column="chat_date" property="chatDate"/>
  </resultMap>

  <resultMap id="ChatroomMap" type="moum.project.vo.Chatroom">
    <id column="chatroom_id" property="no"/>
    <result column="board_id" property="boardNo"/>
    <result column="user_id" property="userNo"/>
  </resultMap>

  <insert id="insertChat" parameterType="moum.project.vo.Chat"
          useGeneratedKeys="true" keyColumn="chat_id" keyProperty="no">
    insert into chat(chatroom_id, user_id, message, chat_date)
    values(#{chatroomNo}, #{userNo}, #{message}, #{chatDate})
  </insert>

  <insert id="insertRoom" parameterType="moum.project.vo.Chatroom"
          useGeneratedKeys="true" keyColumn="chatroom_id" keyProperty="no">
    insert into chatroom(board_id, user_id)
    values(#{boardNo}. #{userNo})
  </insert>

  <select id="listChat" resultMap="ChatMap" parameterType="map">
    select
      chat_id,
      message,
      chat_date
    from
      chat
    where
      chatroom_id = 1
    order by
      chat_date desc
    limit #{pageNo}, #{pageCount}
  </select>

  <select id="listRoom" resultMap="ChatroomMap" parameterType="int">
    select
      distinct cr.chatroom_id
    from
      chatroom cr
      left join chat c on c.chatroom_id = cr.chatroom_id
    where
      cr.board_id = 7
    order by
      c.chat_date desc;
  </select>

  <select id="findBy" resultMap="ChatMap" parameterType="int">

  </select>

  <update id="update" parameterType="moum.project.vo.Chat">

  </update>

  <delete id="delete" parameterType="int">

  </delete>

</mapper>
